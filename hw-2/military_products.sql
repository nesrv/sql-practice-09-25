-- База данных военных изделий (PostgreSQL)

-- Составные типы
CREATE TYPE coordinates AS (
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8)
);

CREATE TYPE dimension AS (
    length_mm INTEGER,
    width_mm INTEGER,
    height_mm INTEGER
);

-- Таблица категорий военных изделий
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(20) UNIQUE NOT NULL,
    description TEXT
);

-- Таблица производителей
CREATE TABLE manufacturers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    country VARCHAR(50) NOT NULL,
    location coordinates,
    founded_year INTEGER,
    specializations TEXT[] -- ARRAY
);

-- Таблица военных изделий
CREATE TABLE military_products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER REFERENCES categories(id),
    manufacturer_id INTEGER REFERENCES manufacturers(id),
    model VARCHAR(100),
    dimensions dimension, -- составной тип
    weight_kg DECIMAL(10,2),
    characteristics JSON, -- основные характеристики
    technical_specs JSONB, -- ТТХ изделия
    production_years INTEGER[],  -- ARRAY годов производства
    status VARCHAR(50) DEFAULT 'active'
);

-- Таблица испытаний
CREATE TABLE tests (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES military_products(id),
    test_date DATE NOT NULL,
    test_location coordinates,
    test_type VARCHAR(100),
    conditions JSONB, -- условия испытаний
    results JSONB, -- результаты испытаний
    participants TEXT[], -- ARRAY участников
    passed BOOLEAN DEFAULT false
);

-- Вставка данных: категории
INSERT INTO categories (name, code, description) VALUES
('Стрелковое оружие', 'SW', 'Индивидуальное и групповое стрелковое оружие'),
('Бронетехника', 'AT', 'Танки, БТР, БМП и другая бронированная техника'),
('Авиация', 'AV', 'Военные самолеты и вертолеты'),
('Ракетное вооружение', 'MS', 'Ракеты различного назначения');

-- Вставка данных: производители
INSERT INTO manufacturers (name, country, location, founded_year, specializations) VALUES
('Концерн Калашников', 'Россия', ROW(56.8431, 60.6454), 1807, 
 ARRAY['стрелковое оружие', 'боеприпасы', 'беспилотники']),
('Уралвагонзавод', 'Россия', ROW(57.9167, 59.9667), 1936,
 ARRAY['танки', 'бронетехника', 'железнодорожная техника']),
('Сухой', 'Россия', ROW(55.7558, 37.6176), 1939,
 ARRAY['истребители', 'штурмовики', 'учебные самолеты']),
('Миль', 'Россия', ROW(55.8058, 37.3387), 1947,
 ARRAY['вертолеты', 'беспилотники', 'авиационные системы']);

-- Вставка данных: военные изделия
INSERT INTO military_products (name, category_id, manufacturer_id, model, dimensions, weight_kg, characteristics, technical_specs, production_years) VALUES
('Автомат Калашникова', 1, 1, 'АК-74М', ROW(943, 70, 214), 3.3,
 '{"калибр": "5.45x39", "режимы_огня": ["одиночный", "автоматический"], "емкость_магазина": 30}',
 '{"эффективная_дальность_м": 500, "темп_стрельбы_выстр_мин": 650, "начальная_скорость_пули_мс": 900, "длина_ствола_мм": 415}',
 ARRAY[1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]),

('Танк Т-90М', 2, 2, 'Т-90М Прорыв', ROW(9530, 3780, 2230), 46500,
 '{"экипаж": 3, "тип_брони": "композитная", "основное_орудие": "125мм", "мощность_двигателя_лс": 1000}',
 '{"макс_скорость_кмч": 60, "запас_хода_км": 550, "толщина_брони_мм": {"лоб": 850, "борт": 400}, "боекомплект_выстрелов": 43}',
 ARRAY[2017, 2018, 2019, 2020, 2021, 2022, 2023]),

('Истребитель Су-35С', 3, 3, 'Су-35С', ROW(21900, 15300, 5900), 18400,
 '{"экипаж": 1, "тип_двигателя": "турбовентиляторный", "количество_двигателей": 2, "макс_высота_м": 18000}',
 '{"макс_скорость_мах": 2.25, "боевой_радиус_км": 1600, "практический_потолок_м": 18000, "тяга_кгс": 14500}',
 ARRAY[2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023]),

('Пулемет ПКМ', 1, 1, 'ПКМ', ROW(1173, 250, 106), 7.5,
 '{"калибр": "7.62x54R", "режимы_огня": ["автоматический"], "емкость_ленты": 250}',
 '{"эффективная_дальность_м": 1500, "темп_стрельбы_выстр_мин": 650, "начальная_скорость_пули_мс": 825, "длина_ствола_мм": 658}',
 ARRAY[1969, 1970, 1971, 1972, 1973, 1974, 1975]),

('БТР-82А', 2, 2, 'БТР-82А', ROW(7700, 2900, 2410), 13500,
 '{"экипаж": 3, "тип_брони": "стальная", "основное_орудие": "30мм", "мощность_двигателя_лс": 300}',
 '{"макс_скорость_кмч": 80, "запас_хода_км": 600, "толщина_брони_мм": {"лоб": 10, "борт": 7}, "боекомплект_выстрелов": 300}',
 ARRAY[2010, 2011, 2012, 2013, 2014, 2015, 2016]),

('Вертолет Ми-28', 3, 3, 'Ми-28Н', ROW(17010, 3850, 3820), 11500,
 '{"экипаж": 2, "тип_двигателя": "турбовальный", "количество_двигателей": 2, "макс_высота_м": 5800}',
 '{"макс_скорость_мах": 0.7, "боевой_радиус_км": 450, "практический_потолок_м": 5800, "тяга_кгс": 2200}',
 ARRAY[2009, 2010, 2011, 2012, 2013, 2014, 2015]),

('Снайперская винтовка СВД', 1, 1, 'СВД', ROW(1220, 240, 70), 4.3,
 '{"калибр": "7.62x54R", "режимы_огня": ["одиночный"], "емкость_магазина": 10}',
 '{"эффективная_дальность_м": 800, "темп_стрельбы_выстр_мин": 30, "начальная_скорость_пули_мс": 830, "длина_ствола_мм": 620}',
 ARRAY[1963, 1964, 1965, 1966, 1967, 1968, 1969]);

-- Вставка данных: испытания
INSERT INTO tests (product_id, test_date, test_location, test_type, conditions, results, participants, passed) VALUES
(1, '2023-05-15', ROW(55.1234, 37.5678), 'Полигонные испытания',
 '{"температура_с": 25, "влажность_процент": 60, "скорость_ветра_мс": 5}',
 '{"точность_угл_мин": 2.5, "надежность_процент": 99.8, "выстрелов_произведено": 10000}',
 ARRAY['Иванов И.И.', 'Петров П.П.', 'Сидоров С.С.'], true),

(2, '2023-08-20', ROW(56.7890, 60.1234), 'Ходовые испытания',
 '{"местность": "смешанная", "температура_с": 30, "дистанция_км": 500}',
 '{"расход_топлива_л100км": 280, "достигнутая_макс_скорость_кмч": 58, "оценка_надежности": 95}',
 ARRAY['Козлов К.К.', 'Волков В.В.'], true),

(3, '2023-09-10', ROW(45.1111, 39.2222), 'Летные испытания',
 '{"высота_м": 10000, "погода": "ясная", "температура_с": -20}',
 '{"достигнутая_макс_скорость_мах": 2.1, "маневренность_g": 9, "проверка_систем": "пройдена"}',
 ARRAY['Орлов О.О.', 'Соколов С.С.', 'Ястребов Я.Я.'], true);